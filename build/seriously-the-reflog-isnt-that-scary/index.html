<!doctype html>
<html>
<head>
    <title>jordan scales</title>
    <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/tomorrow.min.css">
<link rel="stylesheet" href="/css/demos/clicking.css">
<link rel="stylesheet" href="/css/demos/hover.css">
<link rel="stylesheet" href="/css/demos/shared.css">
    <link href="http://fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet"type="text/css">
    <meta charset="utf-8">
    <meta name="viewport" content="width=480">
    <link rel="Shortcut Icon" type="image/x-icon" href="http://s.gravatar.com/avatar/3517596df161030c3779c532f7844383?s=32.gif" />
</head>
<body>
    <div class="main">
        <header>
            <span class="flash" aria-hidden="true">////////</span>
            <strong>jordan scales</strong>
            <span class="sep" aria-hidden="true">.</span>
            <a href="/">home</a>
            <span class="sep" aria-hidden="true">.</span>
            <a href="/projects">projects</a>
            <span class="sep" aria-hidden="true">.</span>
            <a href="http://twitter.com/jdan">twitter</a>
            <span class="sep" aria-hidden="true">.</span>
            <a href="http://github.com/jdan">github</a>
        </header>

        <article class="article">
  <header class="title">
    
      <p>
        <strong>Note:</strong>
        This article is hidden and is only available to those with a link.
      </p>
    

    
      <div class="date">
        August 05, 2013
      </div>
    
    <h1>Seriously, The Reflog Isn&#39;t That Scary</h1>
    <br>
  </header>

  <section class="content">
    <p>I know, I know - changing history can be scary. Rebasing, squashing, and loads of force pushing can worry any junior engineer such as myself, but it really shouldn&#39;t. Truth is, these are powerful tools that you should have on your toolbelt and, contrary to what you may believe, it&#39;s very difficult to actually mess things up.</p>
<p>This guide exhibits my own experience with using the reflog to fix stupid mistakes I&#39;ve made on the command line, and is divided into three sections.</p>
<ul>
<li><a href="#undo-amend">Undoing amended commits</a></li>
<li><a href="#undo-merge">Reverting bad merges</a></li>
<li><a href="#undo-hard-reset">Recovering hard resets</a></li>
</ul>
<h3 id="what-is-the-reflog-">What is the reflog?</h3>
<p>The <a href="https://www.kernel.org/pub/software/scm/git/docs/git-reflog.html">reflog</a> is a special mechanism (which acts very similarly to a branch) that contains any changes to the data in your repository. This includes commiting changes, creating and checking out branches, and even hard resets. It&#39;s a handy timeline, going a step further from the usual history tree, that you can use to recover any data you may have misplaced.</p>
<p>Let&#39;s walk through a couple of use-cases on a <a href="https://github.com/jdan/reflog-example">real repository</a>.</p>
<pre><code>$ git init
Initialized empty Git repository in /Users/jordan/Projects/reflog-example/.git/
$ echo &quot;Hello, world&quot; &gt; hello.txt
$ git add .
$ git commit -m &quot;initial commit.&quot;
[master (root-commit) 9056e55] initial commit.
 1 file changed, 1 insertion(+)
 create mode 100644 hello.txt
</code></pre><p><a id="undo-amend"></a></p>
<h3 id="example-a-undoing-an-amended-commit">Example A: Undoing an Amended Commit</h3>
<p><code>git commit --amend</code> is a great way to consolidate your work. Missed a semicolon? No need to make an entirely new commit for that, just amend the previous one! But, what if we want to <strong>undo</strong> an amend to a commit? We can&#39;t revert a particular commit, since we only want to remove <em>some</em> of the changes in a commit. Seems tricky, but it really isn&#39;t. Let&#39;s start by amending our initial commit.</p>
<pre><code>$ echo &quot;Goodnight, moon&quot; &gt;&gt; hello.txt
$ git add .
$ git commit --amend
[master e1a2208] initial commit.
 1 file changed, 2 insertions(+)
 create mode 100644 hello.txt
</code></pre><p>Now if we view our commit, we&#39;ll see two additions at the bottom.</p>
<pre><code>$ git show HEAD
commit e1a22086fda87daff79fe2bf179372a46abc3044
Author: Jordan Scales &lt;scalesjordan@gmail.com&gt;
Date:   Sun Aug 4 22:46:34 2013 -0700

    initial commit.

diff --git a/hello.txt b/hello.txt
new file mode 100644
index 0000000..f48e806
--- /dev/null
+++ b/hello.txt
@@ -0,0 +1,2 @@
+Hello, world
+Goodnight, moon
</code></pre><p>But what if we wanted to split this up into two commits? This example is trivial, but in the real world you may accidentally amend 100 changes to a previous commit (with 100 changes of its own!) We don&#39;t want them combined, so how can we separate them? <strong>This is where the reflog comes into play</strong>. Let&#39;s see what we get when we run <code>git reflog</code>.</p>
<pre><code>$ git log
commit e1a22086fda87daff79fe2bf179372a46abc3044
Author: Jordan Scales &lt;scalesjordan@gmail.com&gt;
Date:   Sun Aug 4 22:46:34 2013 -0700

    initial commit.
$ git reflog
e1a2208 HEAD@{0}: commit (amend): initial commit.
9056e55 HEAD@{1}: commit (initial): initial commit.
</code></pre><p>While <code>git log</code> only has one entry (which makes sense considering we only have one commit), <code>git reflog</code> actually consists of <em>two</em> entries. This is awesome, we now have some extra material to work with. Notice how the left column looks suspiciously similar to a log? Instead of commits, we&#39;re dealing with <strong>reflog entries</strong>, but they behave just like commits on a branch. To demonstrate this, let&#39;s go ahead and do a soft reset.</p>
<pre><code>$ git reset --soft 9056e55
$ git diff --staged
diff --git a/hello.txt b/hello.txt
index a5c1966..f48e806 100644
--- a/hello.txt
+++ b/hello.txt
@@ -1 +1,2 @@
 Hello, world
+Goodnight, moon
</code></pre><p>Awesome. Now our staged changes consist of just the second addition we made on the master branch. Let&#39;s verify that our first change is still in tact.</p>
<pre><code>$ git show HEAD
commit 9056e55e384cbae33a0aaf9b2a861cb20c20ace0
Author: Jordan Scales &lt;scalesjordan@gmail.com&gt;
Date:   Sun Aug 4 22:46:34 2013 -0700

    initial commit.

diff --git a/hello.txt b/hello.txt
new file mode 100644
index 0000000..a5c1966
--- /dev/null
+++ b/hello.txt
@@ -0,0 +1 @@
+Hello, world
</code></pre><p>Now, let&#39;s go ahead and commit our changes.</p>
<pre><code>$ git commit -m &quot;Second commit&quot;
[master d9b0af2] Second commit
 1 file changed, 1 insertion(+)
$ git log
commit d9b0af228fa2f4e9ac0c453faf5a652b5ccfa55e
Author: Jordan Scales &lt;scalesjordan@gmail.com&gt;
Date:   Sun Aug 4 22:58:55 2013 -0700

    Second commit

commit 9056e55e384cbae33a0aaf9b2a861cb20c20ace0
Author: Jordan Scales &lt;scalesjordan@gmail.com&gt;
Date:   Sun Aug 4 22:46:34 2013 -0700

    initial commit.
</code></pre><p>We&#39;ve successfully separated an amended commit into two separate commits.</p>
<p>You&#39;ll notice that the reflog itself reflects the changes we&#39;ve just made, in case we want to go back yet again.</p>
<pre><code>$ git reflog
d9b0af2 HEAD@{0}: commit: Second commit
9056e55 HEAD@{1}: reset: moving to 9056e55
e1a2208 HEAD@{2}: commit (amend): initial commit.
9056e55 HEAD@{3}: commit (initial): initial commit.
</code></pre><p><a id="undo-merge"></a></p>
<h3 id="example-b-rolling-back-a-bad-merge">Example B: Rolling Back a Bad Merge</h3>
<p>Let&#39;s say we&#39;ve merged some changes from a branch. If our correspondent worked alongside master for quite some time and never <a href="http://blog.steveklabnik.com/posts/2012-11-08-how-to-squash-commits-in-a-github-pull-request">cleaned up</a> his or her changes, we could be dealing with a messy rollback. Let&#39;s see how we would resolve this issue using the reflog.</p>
<pre><code>$ git merge my-awesome-branch
Updating d9b0af2..29ef6ec
Fast-forward
 hello.txt | 3 +++
 1 file changed, 3 insertions(+)
$ git log
commit 29ef6ec17401576b7be9ecfd3cf8eeecb8e26288
Author: Jordan Scales &lt;scalesjordan@gmail.com&gt;
Date:   Sun Aug 4 23:07:41 2013 -0700

    Changes on another branch
    ...
</code></pre><p>Looking at reflog we should see a nice summary of our recent activity.</p>
<pre><code>$ git branch -D my-awesome-branch
Deleted branch my-awesome-branch (was 29ef6ec).
$ git reflog
29ef6ec HEAD@{0}: merge my-awesome-branch: Fast-forward
d9b0af2 HEAD@{1}: checkout: moving from my-awesome-branch to master
29ef6ec HEAD@{2}: commit: Changes on another branch
d9b0af2 HEAD@{3}: checkout: moving from master to my-awesome-branch
d9b0af2 HEAD@{4}: commit: Second commit
9056e55 HEAD@{5}: reset: moving to 9056e55
e1a2208 HEAD@{6}: commit (amend): initial commit.
9056e55 HEAD@{7}: commit (initial): initial commit.
</code></pre><p>We have a few options here. We can revert back to a time before the branch was even created, when the commit was made on the branch, or just before we merged into master. For our use-case, we simply want to undo our merge. <code>d9b0af2</code> looks promising (but there are other equally good choices here). This time, we&#39;ll do a <em>hard</em> reset, since we don&#39;t need to stage any changes before a merge.</p>
<pre><code>$ git reset --hard d9b0af2
HEAD is now at d9b0af2 Second commit
$ git log
commit d9b0af228fa2f4e9ac0c453faf5a652b5ccfa55e
Author: Jordan Scales &lt;scalesjordan@gmail.com&gt;
Date:   Sun Aug 4 22:58:55 2013 -0700

    Second commit

commit 9056e55e384cbae33a0aaf9b2a861cb20c20ace0
Author: Jordan Scales &lt;scalesjordan@gmail.com&gt;
Date:   Sun Aug 4 22:46:34 2013 -0700

    initial commit.
</code></pre><p>Looks good! But now, what if we wanted to go back to our deleted branch?</p>
<pre><code>$ git branch
* master
$ git co my-awesome-branch
error: pathspec &#39;my-awesome-branch&#39; did not match any file(s) known to git.
</code></pre><p>Well that&#39;s kind of a bummer. According to our previous example, we expect the reflog to indicate a point in time where we were working on a separate unmerged branch. What gives? Let&#39;s take another gander at the reflog.</p>
<pre><code>$ git reflog
d9b0af2 HEAD@{0}: reset: moving to d9b0af2
29ef6ec HEAD@{1}: merge my-awesome-branch: Fast-forward
d9b0af2 HEAD@{2}: checkout: moving from my-awesome-branch to master
29ef6ec HEAD@{3}: commit: Changes on another branch
d9b0af2 HEAD@{4}: checkout: moving from master to my-awesome-branch
d9b0af2 HEAD@{5}: commit: Second commit
9056e55 HEAD@{6}: reset: moving to 9056e55
e1a2208 HEAD@{7}: commit (amend): initial commit.
9056e55 HEAD@{8}: commit (initial): initial commit.
</code></pre><p>Hm, <code>29ef6ec</code> indicates a commit on our branch. Let&#39;s explore.</p>
<pre><code>$ git co 29ef6ec
Note: checking out &#39;29ef6ec&#39;.
  ...
HEAD is now at 29ef6ec... Changes on another branch
$ git log
commit 29ef6ec17401576b7be9ecfd3cf8eeecb8e26288
Author: Jordan Scales &lt;scalesjordan@gmail.com&gt;
Date:   Sun Aug 4 23:07:41 2013 -0700

    Changes on another branch
    ...
</code></pre><p>This looks promising! Let&#39;s go ahead and make a branch here.</p>
<pre><code>$ git co -b my-awesome-branch
Switched to a new branch &#39;my-awesome-branch&#39;
$ git log
commit 29ef6ec17401576b7be9ecfd3cf8eeecb8e26288
Author: Jordan Scales &lt;scalesjordan@gmail.com&gt;
Date:   Sun Aug 4 23:07:41 2013 -0700

    Changes on another branch
    ...
</code></pre><p>Success! We&#39;ve now successfully recovered our branch. How about master? Is our rogue commit still separate from the master branch?</p>
<pre><code>$ git co master
Switched to branch &#39;master&#39;
$ git log
commit d9b0af228fa2f4e9ac0c453faf5a652b5ccfa55e
Author: Jordan Scales &lt;scalesjordan@gmail.com&gt;
Date:   Sun Aug 4 22:58:55 2013 -0700

    Second commit
</code></pre><p>Yep.</p>
<p><a id="undo-hard-reset"></a></p>
<h3 id="example-c-recovering-from-a-hard-reset">Example C: Recovering from a Hard Reset</h3>
<p>At this point you should be fairly comfortable with the reflog, and can now apply it to many different situations. To really nail it down, let&#39;s go through one more common example: recovering the data from a hard reset. Just as a refresher, consider the state of our master branch.</p>
<pre><code>$ git log
commit d9b0af228fa2f4e9ac0c453faf5a652b5ccfa55e
Author: Jordan Scales &lt;scalesjordan@gmail.com&gt;
Date:   Sun Aug 4 22:58:55 2013 -0700

    Second commit

commit 9056e55e384cbae33a0aaf9b2a861cb20c20ace0
Author: Jordan Scales &lt;scalesjordan@gmail.com&gt;
Date:   Sun Aug 4 22:46:34 2013 -0700

    initial commit.
</code></pre><p>If we wanted to completely wipe the most recent commit - &quot;Second commit&quot; - we can do that rather easily.</p>
<pre><code>$ git reset --hard 9056e55e384cbae33a0aaf9b2a861cb20c20ace0
HEAD is now at 9056e55 initial commit.
$ git log
commit 9056e55e384cbae33a0aaf9b2a861cb20c20ace0
Author: Jordan Scales &lt;scalesjordan@gmail.com&gt;
Date:   Sun Aug 4 22:46:34 2013 -0700

    initial commit.
</code></pre><p>And voilà, it&#39;s gone. But, what if that commit had some important data in it? What if we were careless with our hard resets, and accidentally removed important changes? Sometimes this really happens, and we can use the reflog to our advantage and recover the lost changes.</p>
<p>Once again, let&#39;s consult the reflog.</p>
<pre><code>$ git reflog
9056e55 HEAD@{0}: reset: moving to 9056e55e384cbae33a0aaf9b2a861cb20c20ace0
d9b0af2 HEAD@{1}: checkout: moving from save-branch to master
29ef6ec HEAD@{2}: checkout: moving from 29ef6ec17401576b7be9ecfd3cf8eeecb8e26288 to save-branch
29ef6ec HEAD@{3}: checkout: moving from master to 29ef6ec
d9b0af2 HEAD@{4}: reset: moving to d9b0af2
29ef6ec HEAD@{5}: checkout: moving from my-awesome-branch to master
...
</code></pre><p>Here we&#39;ll see lots of data, but we&#39;re only considered with the first two entries: the current state, and the previous checkout.</p>
<blockquote>
<p>As a sidenode, feel free to check out <a href="http://gitready.com/intermediate/2009/02/09/reflog-your-safety-net.html">reflog, your safety net</a> on git ready, which goes on to explain how to clean up old entries in your reflog.</p>
</blockquote>
<p>Now, all we need to do is trek back to that previous entry. Easy stuff.</p>
<pre><code>$ git reset --hard d9b0af2
HEAD is now at d9b0af2 Second commit
$ git log
commit d9b0af228fa2f4e9ac0c453faf5a652b5ccfa55e
Author: Jordan Scales &lt;scalesjordan@gmail.com&gt;
Date:   Sun Aug 4 22:58:55 2013 -0700

    Second commit

commit 9056e55e384cbae33a0aaf9b2a861cb20c20ace0
Author: Jordan Scales &lt;scalesjordan@gmail.com&gt;
Date:   Sun Aug 4 22:46:34 2013 -0700

    initial commit.
</code></pre><p>And there you have it, we&#39;ve successfully recovered data from a hard reset.</p>
<p><a id="closing-notes"></a></p>
<h3 id="closing-notes">Closing Notes</h3>
<p>I hope you found this little guide useful, and I bet you are now more than capable of solving a variety of problems using the reflog. You may have noticed that git tries really, <em>really</em> hard not to lose your data and includes <a href="https://www.kernel.org/pub/software/scm/git/docs/git-fsck.html">many other</a> beautiful utilities to recover lost changes (tools that exceed the scope of this introductory article).</p>
<p>Once you start rebasing and changing history, recovering that seemingly lost data becomes more and more important. A good understanding of the reflog can relieve your headache when things go wrong.</p>
<blockquote>
<p>If you enjoyed this article, let me know! I appreciate all the feedback I can get. You can follow me on twitter at <a href="http://twitter.com/jdan">@jdan</a></p>
</blockquote>

  </section>

  <footer class="more details">
    --
    <br><br>
    <a target="_blank" href="https://twitter.com/intent/tweet?text=%E2%80%9CSeriously%2C%20The%20Reflog%20Isn&#39;t%20That%20Scary%E2%80%9D%20by%20%40jdan%20%E2%80%93%20http%3A%2F%2Fthatjdanisso.cool%2Fseriously-the-reflog-isnt-that-scary" class="tweet">tweet this</a>
    <a href="/">&laquo; back to home</a>
  </footer>
</article>

    </div>

    <script src="/js/flasher.js"></script>
<script src="/js/demos/clicking.js"></script>
<script src="/js/demos/hover.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-60897046-1', 'auto');
        ga('send', 'pageview');
    </script>
</body>
</html>
